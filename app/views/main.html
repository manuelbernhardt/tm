#{extends 'header.html' /}

<div id="screen" style="display:none;">

    #{if play.Play.id.equals("demo")}
    #{feedbackBar /}
    #{/if}


    #{topMenu space:'application' /}

    #{tabLayout id:'main-wrapper'}
    #{tabs id:'tabs'}
    #{tab link:@Dashboard.index(), title:'Dashboard', controller:'Dashboard' /}
    #{deadbolt.restrict roles:[[models.general.UnitRole.REQVIEW]]}
    #{tab link:@Requirements.index(), title:'Requirements', controller:'Requirements' /}
    #{/deadbolt.restrict}
    #{deadbolt.restrict roles:[[models.general.UnitRole.TESTREPOVIEW]]}
    #{tab link:@Repository.index(), title:'Test Scripts repository', controller:'Repository' /}
    #{/deadbolt.restrict}
    #{deadbolt.restrict roles:[[models.general.UnitRole.TESTPREPVIEW]]}
    #{tab link:@Preparation.index(), title:'Test preparation', controller:'Preparation' /}
    #{/deadbolt.restrict}
    #{deadbolt.restrict roles:[[models.general.UnitRole.TESTEXECVIEW]]}
    #{tab link:@Execution.index(), title:'Test execution', controller:'Execution' /}
    #{/deadbolt.restrict}
    #{deadbolt.restrict roles:[[models.general.UnitRole.DEFECTVIEW]]}
    #{tab link:@Defects.index(), title:'Defects', controller:'Defects' /}
    #{/deadbolt.restrict}
    #{/tabs}
    #{tabContent}
    #{doLayout /}
    #{/tabContent}
    #{/tabLayout}
</div>


<script type="text/javascript">
    $(document).ready(function() {
        $('#screen').show();
        $('.searchInput').watermark('Search');
        applyButtonStyles();
        feedbackInit();
        <!-- address of page that is feedbacked -->

        $('#sendFeedback').button().click(function() {
            $.post("@{TMController.sendFeedbackEmail()}", {name: $('#personName').val(), message:$('#messageFeedback').val(), location: window.location.pathname},
                    function() {
                        $('#thanksNote').show().delay(1700).slideUp();
                        $('#feedbackElementsWrapper').hide().delay(3000).slideDown();
                        $('#feedbackContainer').animate({bottom: '-' + parseInt($('#feedbackContainer').outerHeight(), 10) + 'px' }, 1800).removeClass('open');
                        $('#messageFeedback').val('');
                    }).error(errorHandler);
        })

        $('#cancelFeedback').button().click(function() {
            $('#feedbackContainer').animate({bottom: '-' + parseInt($('#feedbackContainer').outerHeight(), 10) + 'px' }, 300).removeClass('open');
            $('#messageFeedback').val('');
        })
    });
</script>
