#{extends 'main.html' /}
#{set title:'Test execution' /}

#{box 'Filters'}
<form action="index.html">
  <div class="field">
    <label for="cycle">Test cycle</label>
    <select id="cycle" name="cycle">
      <option value="" label="Select a cycle"></option>
      #{list items:releases, as:'release'}
      <optgroup label="${release.name}">
        #{list items:release.getTestCycles(), as:'cycle'}
        <option label="${cycle.name}" value="${cycle.id}"></option>
        #{/list}
      </optgroup>
      #{/list}
    </select>
  </div>
  <div class="field">
    <label for="status">Status</label>
    <select id="status" name="status">
      <option value="" label="Select a status"></option>
      #{list items:models.project.test.ExecutionStatus.values(), as:'s'}
      <option label="${s}" value="${s.getKey()}"></option>
      #{/list}
    </select>
  </div>
  <div class="field">
    <label for="responsible">Assigned to</label>
    <select id="responsible" name="responsible">
      <option value="" label="Select a person"></option>
      #{list items:users, as:'user'}
      <option label="${user.getFullName()}" value="${user.getId()}"></option>
      #{/list}
    </select>
  </div>
</form>

#{/box}

<br/>

<div class="container ui-widget-content">

  <div class="left_table">

    <table class="display" id="instanceTable">
      <thead>
      <tr>
        <th>Tags</th>
        <th>Test instance</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>

  </div>

  <div class="right_table">
    <div id="content">No test instance selected</div>
  </div>

</div>


<script type="text/javascript">
  $(document).ready(function() {

    #{tabularasa.init tableId:'instanceTable'}
    var instanceTableParameters = {
      "aoColumns": [
        {"sName": "id", "sClass": "sNone" },
        {"sName": "tagNames"},
        {"sName": "name"},
        {"sName": "executionStatus.name"}
      ],
      "sAjaxSource": "@{Execution.instances()}",
      "bProcessing": true,
      "bServerSide": true,
      "bLengthChange": false,
      "bSort": false,
      "bFilter": false,
      "iDisplayLength": 10,
      "bInfo": false,
      "oLanguage": {
        "sZeroRecords": "No test instances found"
      }
    };
    #{/tabularasa.init}

    handleRowSelection('instanceTable', function(selectedRowId) {
      $.get('@{Execution.content()}', { instanceId: selectedRowId }, function(data) {
        $('#content').html(data);
      });

    });

  });
</script>