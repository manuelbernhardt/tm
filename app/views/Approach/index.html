#{extends 'main.html' /}
#{set title:'Test approach' /}


<div class="container">
  <div class="left_tree">
    <div id="actions">
      <input type="button" id="create_release" value="Create release"/>
      <input type="button" id="create_cycle" value="Create cycle"/>
      <input type="button" id="remove" value="Remove"/>
    </div>
    <div id="approachTree" class="tree"></div>
  </div>
  <div class="right_tree">
    <div id="details">No cycle selected</div>
  </div>
</div>


#{set 'moreScripts'}
<script type="text/javascript">

  $(document).ready(function () {

    #{include 'Approach/approachTree.js' /}
    #{tree.common id:"approachTree", controller:"TMTreeController" /}

    /** Selection listener **/
    $("#approachTree").bind("select_node.jstree", function (e, data) {
      if(isSelectedNodeType(data, ['default', 'approachTestCycle'])) {
        $.get('@{Approach.cycleDetails()}', { cycleId: getSelectedNode(data) }, function(data) {
          $('#details').html(data);
        });
      } else if(isSelectedNodeType(data, ['approachRelease'])) {
        $.get('@{Approach.releaseDetails()}', { releaseId: getSelectedNode(data) }, function(data) {
          $('#details').html(data);
        });
      }
    });


    /** button initialisation **/
    $("#create_release").click(function () {
      $("#approachTree").jstree("create", null, "last", {attr:{"rel":"approachRelease"}});
    })
    $("#create_cycle").click(function () {
      $("#approachTree").jstree("create", null, "last", {attr:{"rel":"default"}});
    })
    $("#remove").click(function () {
      $("#approachTree").jstree("remove", null);
    })

  });

</script>
#{/set}
