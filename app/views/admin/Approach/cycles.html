

<div id="cycleDeletionConfirmationDialog" title="Confirm deletion"></div>

#{infoBox}
When Test Cycles are defined for a project, the newly created Test Instances will require to be assigned to a Test Cycle. Test Execution progress can then be checked against the planned execution.<br/>
Alternatively simple tags can be used to organize the Test Execution.
#{/}

        <!-- todo reorganise css classes to fit different width and positioning needs-->

<div class="container">
    <div id="actions" class="actions">
        <div class="actions buttons">
          <button id="create_release">Release</button>
          <button id="create_cycle">Cycle</button>
          <button id="remove_cycleRelease">Remove</button>
        </div>
    </div>
  <div class="tree-container">
      <div class="left_tree" style="width:29%">
        #{box 'Releases and Cycles'}
        <div id="approachTree" class="tree" style="border:none;"></div>
        #{/box}
      </div>
      <div class="right_table" style="width:70%">
    <div id="details">No cycle selected</div>
  </div>
  </div>
</div>


<script type="text/javascript">

  $(document).ready(function () {

        $("#projectTree").bind("select_node.jstree", function (e, data) {

        $('#approachTree').tree(
                {
                  "args" : {"projectId": getSelectedNodeId('projectTree')},
                  types: approachTreeTypes,
                  onDeleteFailed: function() {
                    errorMessage("Could not delete requirement/cycle - make sure there are no linked instances left.", "Error deleting requirement/cycle")
                  },
                  onRename: function(name) {
                    $('#cycle_name').val(name);
                  }
                }
        );

        refreshTree('approachTree');

        /** button initialisation **/
        $("#create_release").button({icons: {primary: 'ui-icon-plus'}}).click(function () {
          $("#approachTree").jstree("create", -1, "last", {attr:{"rel":"release"}, data:"New release", metadata: {args: {projectId: getSelectedNodeId('projectTree')}}});
        });
        $("#create_cycle").button({icons: {primary: 'ui-icon-plus'}}).click(function () {
          $("#approachTree").jstree("create", null, "last", {attr:{"rel":"default"}, data:"New cycle", metadata: {args: {projectId: getSelectedNodeId('projectTree')}}});
        });
        $("#remove_cycleRelease").button({icons: {primary: 'ui-icon-trash'}, text: false, disabled: true}).click(function () {
            deletionConfirmation('cycleDeletionConfirmationDialog','Project cycle', getSelectedNodeName('approachTree') ,function(){
                $("#approachTree").jstree("remove", null);
            })

        });


    /** Selection listener **/
        $("#approachTree").bind("select_node.jstree", function (e, data) {
          if (isSelectedNodeType(data, ['default', 'testCycle'])) {
           $("#remove_cycleRelease").button('enable');
            $.get('@{admin.Approach.cycleDetails()}', { cycleId: getNodeIdFromData(data) }, function(data) {
              $('#details').html(data);
            }).error(errorHandler);
          } else if (isSelectedNodeType(data, ['release'])) {
            $("#remove_cycleRelease").button('enable');
            $.get('@{admin.Approach.releaseDetails()}', { releaseId: getNodeIdFromData(data) }, function(data) {
              $('#details').html(data);
            }).error(errorHandler);
          }
        });
     });

  });

</script>

