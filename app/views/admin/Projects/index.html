#{extends 'admin/main.html' /}
#{set title:'Project administration' /}

<div class="container">
    <div class="actions">
        <div class="actions buttons">
            <button id="create_category">Project Category</button>
            <button id="create_project">Project</button>
            <button id="remove">Remove</button>
        </div>
    </div>
    <div class="tree-container">

      <div class="left_tree">
        #{box 'Projects'}
            <div id="projectTree" class="tree" style="border-style:none;"></div>
        #{/box}
      </div>
      <div class="right_tree">
    <div id="innerTabs">
      <ul>
        <li><a href="@{admin.Projects.projectDetails()}" id="projectDetailsLink"><span>Project details</span></a></li>
        <li><a href="@{admin.Approach.cycles()}" id="cyclesLink"><span>Test cycles</span></a></li>
        <li><a href="@{admin.Projects.tags()}" id="tagsLink"><span>Tags</span></a></li>
        <li><a href="@{admin.Projects.roles()}" id="rolesLink"><span>Roles</span></a></li>
        <li><a href="@{admin.Projects.users()}" id="usersLink"><span>Users</span></a></li>
      </ul>
    </div>
  </div>
</div>
</div>

<script type="text/javascript">
  $(document).ready(function () {

    $("#innerTabs").tabs({
      select: function() {
        removeDialogs();
      }
    });

    $("#projectTree").tree({types: projectTreeTypes, onRename: function(name){
        $('#project_name').val(name);
    }
    });

    /** Selection listener **/
    $("#projectTree").bind("select_node.jstree", function (e, data) {
      var tabLinks = ['@{admin.Projects.projectDetails()}', '@{admin.Approach.cycles()}', '@{admin.Projects.tags()}', '@{admin.Projects.roles()}', '@{admin.Projects.users()}'];
      treeNodeSelectionHandler(tabLinks, ['default'], 'project', $('#innerTabs'), data);
    });

    /** Button initialisation **/
    $("#create_category").button({icons: {primary: 'ui-icon-plus'}}).click(function () {
      $("#projectTree").jstree("create", null, "last", {attr:{"rel":"category"}, data: "New category"});
    });

    $("#create_project").button({icons: {primary: 'ui-icon-plus'}}).click(function () {
      $("#projectTree").jstree("create", null, "last", {attr:{"rel":"default"}, data:"New project"});
    });

    $("#remove").button({icons: {primary: 'ui-icon-minus'}}).click(function () {
      $("#projectTree").jstree("remove", null);
    });

  });
</script>