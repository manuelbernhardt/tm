#{fixture delete:'all', load:'selenium/testData.yml' /}

#{selenium 'Test 1100-Admin Users Full'}

    // Try to access the user administration area and check that it contains the expected tabs
    open('/admin')
    clickAndWait('//ul[@id='tabs_header']/li[1]/a/span')
    verifyElementPresent('//a[@id='userDetailsLink']/span')
    verifyElementPresent('//a[@id='projectsLink']/span')
    verifyElementPresent('accountLink')

    // USER DETAILS
    // Verify content of a random row of user table
    verifyElementPresent('//table[@id='tab']/tbody/tr[4]/td[2]')
    verifyText('//table[@id='tab']/tbody/tr[4]/td[2]','Vroni')

    // Attempt new user creation
    click('newUserDialogSubmitButton')
    type('user_user_firstName','John')
    type('user_user_lastName','Doe')
    type('user_user_email','email@newUser.com')
    type('user_user_password','test')
    click('//div[7]/div[3]/div/button[1]')

    // Verify new user listed in user table
    type('//input[@type='text']','Doe')
    fireEvent('//input[@type='text']','keyup')
    waitForText('//table[@id='tab']/tbody/tr/td[2]','John')
    verifyText('//table[@id='tab']/tbody/tr/td[3]','Doe')

    // Check content of user details edit form
    click('//table[@id='tab']/tbody/tr/td[3]')
    verifyElementPresent('user_user_firstName')
    waitForValue('user_user_firstName','John')
    verifyElementPresent('user_user_lastName')
    waitForValue('user_user_lastName','Doe')
    verifyElementPresent('user_user_email')
    waitForValue('user_user_email','email@newUser.com')
    verifyElementPresent('user_user_phone')
    waitForValue('user_user_phone')
    verifyElementPresent('profileForm_submit')

    // Perform user details change
    type('user_user_lastName','Smith')
    type('user_user_email','john@smith.com')
    click('profileForm_submit')

    // Check values are saved after form submition both in user table and user details tab
    type('//input[@type='text']','Smith')
    fireEvent('//input[@type='text']','keyup')
    waitForText('//table[@id='tab']/tbody/tr/td[3]','Smith')
    verifyElementPresent('user_user_lastName')
    verifyValue('user_user_lastName','Smith')


    // PROJECT ROLES ASSIGNMENT
    click('//a[@id='projectsLink']/span')
    waitForElementPresent('assign-role')
    waitForElementPresent('unassign-role')

    // Assign role
    click('assign-role')
    waitForElementPresent('categories','label=2011')
    select('categories','label=2011')
    click('//option[@value='1']')
    waitForElementPresent('projects','label=Test Management Application')
    select('projects','label=Test Management Application')
    click('//select[@id='projects']/option[3]')
    waitForElementPresent('roles','label=Test Lead')
    select('roles','label=Test Lead')
    click('//div[11]/div/button[1]')

    // Verify role assignment before and after tab reload
    waitForTextPresent('2011')
    waitForTextPresent('Test Management Application')
    waitForTextPresent('Test Lead')
    click('//a[@id='userDetailsLink']/span')
    click('//a[@id='projectsLink']/span')
    waitForTextPresent('2011')
    waitForTextPresent('Test Management Application')
    waitForTextPresent('Test Lead')

    // Remove role
    waitForElementPresent('link=Test Lead')
    click('link=Test Lead')
    click('unassign-role')

    // Verify role removal
    verifyTextNotPresent('Test Lead')

    // ACCOUNT ROLES
    // To be added when functionality is available

#{/selenium}